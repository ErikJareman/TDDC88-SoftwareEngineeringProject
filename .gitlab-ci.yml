stages:
  - lint
  - deploy
  - test

# Checks the code standard using pylint
# TODO: update path to real python code when we start using python
# python_lint:
#  image: python:3.9.7
#  stage: lint
#  script:
#    - pip install pylint
#    - cd app/testing/unit_testing/python
#    - pylint *.py --disable=imports

# Checks the code standard using eslint for React js
#reactjs_lint:
#  image: node:17.0.1
#  stage: lint
#  script:
#    - cd app/
#    - npm install eslint-plugin-react@7.26.1 --save-dev
#    - npx eslint src/**/*.js src/*.js
    

#deploy to heroku
deploy:
  image: ruby:3.0.2
  stage: deploy
  script:
    - cd app
    - apt-get update -qy
    - apt-get install -y ruby-dev
    - gem install dpl
    - dpl --provider=heroku --app=development-c4 --api-key=$HEROKU_API_KEY
  only:
    - development


install_chrome:
  image: ubuntu:18.04
  stage: test
  script:
    - apt-get update
    - apt-get install -y python3-pip
    # Install robot framework and the selenium library
    - pip3 install robotframework
    - pip3 install robotframework-seleniumlibrary
    # Install the chrome and chrome webdriver
    - apt-get install -y xvfb
    - apt-get install -y zip
    - apt-get install -y wget
    - apt-get install -y ca-certificates
    - apt-get install -y libnss3-dev libasound2 libxss1 libappindicator3-1 libindicator7 gconf-service libgconf-2-4 libpango1.0-0 xdg-utils fonts-liberation libgbm1
    - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb 
    - dpkg -i google-chrome*.deb 
    - rm google-chrome*.deb
    - wget -N http://chromedriver.storage.googleapis.com/89.0.4389.23/chromedriver_linux64.zip
    - unzip chromedriver_linux64.zip
    - chmod +x chromedriver
    - cp chromedriver /usr/local/bin
    - rm chromedriver_linux64.zip
    - rm chromedriver
