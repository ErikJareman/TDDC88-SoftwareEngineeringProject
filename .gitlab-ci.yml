image: node:latest

stages:
  - lint
  - test
  - deploy

# Checks the code standard using pylint
# TODO: update path to real python code when we start using python
python_lint:
  image: python:latest
  stage: lint
  script:
    - pip install pylint
    - cd unit_testing/python/
    - pylint *.py --disable=imports

# Checks the code standard using eslint for React js
reactjs_lint:
  stage: lint
  script:
    - cd app/
    - npm install eslint-plugin-react --save-dev
    - npx eslint src/**/*.js src/*.js
      
# Testing for JavaScript
js_test:
  stage: test
  script:
    - cd unit_testing/javascript
    - npm install jest --global
    - npm test

# Testing for Python
python_test:
  image: python:latest
  stage: test
  script:
    - cd unit_testing/python
    - python -m unittest discover -p '*_test.py'
    
#deploy to heroku
deploy:
  image: ruby:latest
  stage: deploy
  script:
    - cd app
    - apt-get update -qy
    - apt-get install -y ruby-dev
    - gem install dpl
    - dpl --provider=heroku --app=development-c4 --api-key=$HEROKU_API_KEY
  only:
    - development
    - master

