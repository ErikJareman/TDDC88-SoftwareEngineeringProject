image: node:latest

stages:
  - build
  - test
  - deploy

# Check if the code compiles
build:
  stage: build
  script:
    - cd app/
    - npm install
  
        
# Testing for JavaScript
js_test:
  stage: test
  script:
    - cd unit_testing/javascript
    - npm install jest --global
    - npm test

# Testing for Python
python_test:
  image: python:latest
  stage: test
  script:
    - cd unit_testing/python
    - python -m unittest discover -p '*_test.py'
    
#deploy to heroku
deploy:
  image: ruby:latest
  stage: deploy
  script:
    - cd app
    - apt-get update -qy
    - apt-get install -y ruby-dev
    - gem install dpl
    - dpl --provider=heroku --app=development-c4 --api-key=$HEROKU_API_KEY
  only:
        - master
        - ntest

